define("quoteRequest/models/model",[],function(){AppRoot.register.factory("QuoteRequestModel",["AppModel","AppConfig","$rootScope","MainEvent",function(e,t,o,r){var i=!1,a=!1,d=!1,s=[],l=[],c={};return{setCustomerAddress:function(e){""!==e&&(a=!0,c=e,o.$emit(r.ALL_QUOTE_DETAILS_LOADED,"customerDetails"))},getCustomerAddress:function(){return c},isCustomerAddressSet:function(){return a},setAllCountryDetails:function(e){if(""!==e&&void 0!==e){var t;for(t=0;t<e.length;t++)l.push(e[t]);d=!0}o.$emit(r.ALL_QUOTE_DETAILS_LOADED,"countryList")},getCountryList:function(){return l},isAllCountryLoaded:function(){return d},setProductList:function(e){if(""!==e&&void 0!==e){var t;for(t=0;t<e.length;t++)s.push(e[t]);i=!0}o.$emit(r.ALL_QUOTE_DETAILS_LOADED,"productDetails")},getProductList:function(){return s},isAllProductLoaded:function(){return i}}}])}),define("quoteRequest/services/service",[],function(){quoteRequestModule.register.factory("QuoteRequestService",["$http","AppModel","QuoteRequestModel",function(p,g,o){var r=g.getApiKey(),i=g.serviceAPIURL();return{fetchCustomerAddress:function(e){var t=$.param({apikey:r,store_customer_id:e});p({method:"POST",url:i+"reqmethod=getCustomerById",data:t,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){e.data&&o.setCustomerAddress(e.data)})},getAllCountry:function(){var e=$.param({apikey:r,storeId:""});p({method:"POST",url:g.serviceAPIURL()+"reqmethod=getAllCountries",data:e,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){o.setAllCountryDetails(e.data)})},loadProducts:function(){p.get(i+"reqmethod=getAllProducts&loadVariants=true&preDecorated=false&apikey="+encodeURIComponent(r)+"&storeId=null").success(function(e){e.product&&o.setProductList(e.product)}).error(function(e,t,o,r){console.log("error load product List: ",e)})},getSimpleProductDetails:function(e){return p.get(i+"reqmethod=getSimpleProduct&id="+e+"&apikey="+encodeURIComponent(r)+"&confId="+e)},loadVariantsData:function(e){return p.get(i+"reqmethod=getVariants&conf_pid="+e+"&apikey="+encodeURIComponent(r))},loadPrintMethodByProduct:function(e){return p.get(i+"reqmethod=getPrintMethodByProduct&pid="+e+"&apikey="+encodeURIComponent(r))},getSizeVariant:function(e,t){return p.get(i+"reqmethod=getSizeAndQuantity&productId="+e+"&simplePdctId="+t+"&apikey="+encodeURIComponent(r))},getProductDetailsByClient:function(e,t){if(t)var o=p.get(i+"reqmethod=getSimpleProductClient&id="+t+"&print_method_id="+g.getPrintId()+"&apikey="+encodeURIComponent(r)+"&confId="+e+"&store="+g.getStoreId());else o=p.get(i+"reqmethod=getSimpleProductClient&id="+e+"&print_method_id="+g.getPrintId()+"&apikey="+encodeURIComponent(r)+"&confId="+e+"&store="+g.getStoreId());return o},getAllStateByCountryCode:function(e){var t=$.param({apikey:g.getApiKey(),country_code:e,storeId:""});return p({method:"POST",url:g.serviceAPIURL()+"reqmethod=getStateByCountryCode",data:t,headers:{"Content-Type":"application/x-www-form-urlencoded"}})},getRefId:function(e){var t=$.param({apiKey:encodeURIComponent(g.getApiKey()),refid:0,jsonData:e});return p({method:"POST",url:g.serviceAPIURL()+"reqmethod=getQuoteRefData",data:t,headers:{"Content-Type":"application/x-www-form-urlencoded"}})},submitQuoteRequest:function(e,t,o,r,i,a,d,s,l,c,n){var u=$.param({api_key:g.getApiKey(),subject:i,description:d,admin_type:"Super Admin",customer_id:e,shipping_address_id:s,customer_due_date:a,svgProductData:t,ref_id:r,products:l,customerData:c,flag:n});return p({method:"POST",url:g.serviceAPIURL()+"reqmethod=generateQuoteFromDesignStudio",data:u,headers:{"Content-Type":"application/x-www-form-urlencoded"}})},getAllShippingAddress:function(e){var t=$.param({apikey:g.getApiKey(),user_id:e});return p({method:"POST",url:g.serviceAPIURL()+"reqmethod=getAllShippingaddress",data:t,headers:{"Content-Type":"application/x-www-form-urlencoded"}})},addShippingAddress:function(e){var t=$.param({apikey:g.getApiKey(),user_id:g.getCustomerId(),address_line_one:e.address_line_one,address_line_two:e.address_line_two,city:e.city,state:e.state,country:e.country,postcode:e.postcode,storeId:""});return p({method:"POST",url:g.serviceAPIURL()+"reqmethod=addNewShippingaddress",data:t,headers:{"Content-Type":"application/x-www-form-urlencoded"}})}}}])}),define("quoteRequest/controllers/controller",[],function(){quoteRequestModule.register.controller("QuoteRequestController",["$scope","$rootScope","AppModel","MainEvent","QuoteRequestService","$timeout","QuoteRequestModel","AppModelService",function(m,t,f,h,D,P,o,y){m.countryList=[],m.stageProductDetails={colorArray:[],selectedColor:[],productDetails:{},priceAfterDesign:0,designPrice:0},m.stateList=[],m.billingAddress={quoteDetails:{},multiShippingAddress:[],newShippingAddress:{}},m.sendCustomerObject={},m.showCaptureLoader=!0,m.imageSides=[],m.productList=[],m.stateList=[],m.totalProductList=[],m.quoteFormDetailsObj={qty:1,color:"",size:"",printProcess:"",selectedProductId:"",selectedSimpleProductId:"",selectedProductPrice:"",selectedProductType:"",selectedProduct:"",selectedcolor:[],selectedsize:"",selectedPrintProcess:"",selectedPrintProcessId:"",selectedProductImage:[],selectedColorDisabled:[],capturBase64Images:[]},m.productAndQtyDetails=[],m.isColorSet=!0,m.quoteDetailsValidator=!1,m.productStageError=!1,m.quoteCustomerDetailsValidator=!1,m.formLoader=!0,m.isAddressEdit=!0,m.sameColorRepeatError=!1,m.currency=f.getCurrency().prefix,m.colorPalateDisabled=!1,m.colorLoader=!1,m.colorAddProductLoader=!1,m.showAddColorDiv=[],m.disabelColor=[],m.captureHt=500,m.captureWt=500,m.shipAddChecked=!1;var A=[],C=[],_=!1,b=!1;function r(){var e;for(e=o.getProductList(),i=0;i<e.length;i++)e[i].id!=m.stageProductDetails.productDetails.pid&&(m.productList.push(e[i]),m.totalProductList.push(e[i]));""!==m.stageProductDetails.productDetails.xecolor&&D.loadVariantsData(m.stageProductDetails.productDetails.pid).then(function(e){if(e.data)for(m.stageProductDetails.colorArray=[],i=0;i<e.data.variants.length;i++)e.data.variants[i].xeColor.toUpperCase()!=m.stageProductDetails.productDetails.xecolor.toUpperCase()&&m.stageProductDetails.colorArray.push(e.data.variants[i])})}m.isAddNewAddresss=!1,m.addressLoader=!1,m.addedLast=!1,m.init=function(){D.fetchCustomerAddress(f.getCustomerId()),m.$emit(h.MAIN_PRELOADER_SHOW_HIDE,!1,"generateQuote"),o.isAllCountryLoaded()&&o.isAllProductLoaded()?(d(),m.countryList=o.getCountryList(),P(function(){r()},300)):(D.getAllCountry(),D.loadProducts()),function(){var e=new Date,t=e.getMonth()+1,o=e.getDate(),r=e.getFullYear();t<10&&(t="0"+t.toString());o<10&&(o="0"+o.toString());var i=r+"-"+t+"-"+o;m.validateDate=i}()},m.closeQuote=function(e){"success"===e?(m.$emit(h.ALERT_SHOW,{type:"success",message:"QUOTE REQUEST SENT"}),a()):"failed"===e&&(m.$emit(h.ALERT_SHOW,{message:"stage capture Failed"}),a()),t.$emit(h.CLOSE_QUOTE_POPUP)},t.$on("GET_ALL_SIDES_DATA",function(e,t){m.showCaptureLoader=!1,m.imageSides=t.sides,m.sideLabels=[];for(var o=0;o<t.productDetails.maskInfo.length;o++)"1"==t.productDetails.maskInfo[o].is_visible&&m.sideLabels.push(t.productDetails.printsize[o]);m.stageProductDetails.productDetails=angular.copy(t.productDetails),m.stageProductDetails.defaultSides=t.defaultSides,m.stageProductDetails.priceAfterDesign=t.priceAfterDesign;var r=0;P(function(){for(o=0;o<m.stageProductDetails.productDetails.quantities.length;o++)r=parseFloat(r+m.stageProductDetails.productDetails.quantities[o].quantityVal);m.stageProductDetails.designPrice=parseFloat(t.priceAfterDesign/r).toFixed(2)},300)}),t.$on(h.ALL_QUOTE_DETAILS_LOADED,function(e,t){"countryList"===t?m.countryList=o.getCountryList():"customerDetails"===t?d():"productDetails"===t&&r()}),m.selectedProductFun=function(e){m.isColorSet=!0,m.quoteFormDetailsObj.selectedProductImage=[],m.quoteFormDetailsObj.selectedProduct=e.name,m.quoteFormDetailsObj.selectedProductId=e.id,m.quoteFormDetailsObj.selectedcolor=[],m.quoteFormDetailsObj.selectedsize="",m.quoteFormDetailsObj.selectedPrintProcess="",m.quoteFormDetailsObj.selectedPrintProcessId="",e.id&&("simple"===e.product_type?(m.quoteFormDetailsObj.selectedSimpleProductId=e.id,D.getSimpleProductDetails(e.id).then(function(e){e.data&&(m.quoteFormDetailsObj.selectedProductPrice=e.data.price,e.data.xecolor?(m.isColorSet=!0,m.quoteFormDetailsObj.color=[{xeColor:e.data.xecolor}]):(m.isColorSet=!1,m.quoteFormDetailsObj.color=""),e.data.xesize?m.quoteFormDetailsObj.size=[{xe_size:e.data.xesize}]:m.quoteFormDetailsObj.size="")})):(m.quoteFormDetailsObj.selectedSimpleProductId="",m.quoteFormDetailsObj.selectedProductPrice="",D.loadVariantsData(e.id).then(function(e){e.data?(m.isColorSet=!0,m.quoteFormDetailsObj.color=e.data.variants,m.quoteFormDetailsObj.selectedProductPrice=e.data.price):(m.isColorSet=!1,m.quoteFormDetailsObj.color="")})),D.getProductDetailsByClient(e.id).then(function(e){e.data&&""!==e.data&&(m.quoteFormDetailsObj.selectedProductImage=e.data.sides,m.quoteFormDetailsObj.selctedTemplate=e.data.is_product_template,m.quoteFormDetailsObj.selectedProductPrice=e.data.price)}),D.loadPrintMethodByProduct(e.id).then(function(e){e.data&&(m.quoteFormDetailsObj.printProcess=e.data,m.quoteFormDetailsObj.selectedPrintProcess=e.data[0].name,m.quoteFormDetailsObj.selectedPrintProcessId=e.data[0].print_method_id)}))},m.selectedColorFun=function(t){null!==t&&(m.quoteFormDetailsObj.selectedcolor=[],m.quoteFormDetailsObj.selectedsize="Select",m.isColorSet=!1,"simple"!=m.quoteFormDetailsObj.selectedProductType&&D.getSizeVariant(m.quoteFormDetailsObj.selectedProductId,t.id).then(function(e){e.data&&(angular.forEach(e.data.quantities,function(e,t){e.minQuantity=0===t?1:0}),m.quoteFormDetailsObj.size=e.data.quantities,t.size=[],t.size=e.data.quantities,m.quoteFormDetailsObj.selectedcolor.push(t),0==e.data.quantities[0].xe_size_id&&(m.quoteFormDetailsObj.selectedProductPrice=e.data.quantities[0].price))}),D.getProductDetailsByClient(m.quoteFormDetailsObj.selectedProductId,t.id).then(function(e){e.data&&""!==e.data&&(m.quoteFormDetailsObj.selectedProductImage=e.data.sides)}))};var a=function(){m.quoteFormDetailsObj={qty:1,color:"",size:"",printProcess:"",selectedProductId:"",selectedSimpleProductId:"",selectedProductPrice:"",selectedProductType:"",selectedProduct:"",selectedcolor:[],selectedsize:"",selectedPrintProcess:"",selectedPrintProcessId:"",selectedProductImage:[],selectedColorDisabled:[]},m.productAndQtyDetails=[],m.isColorSet=!1,m.billingAddress={},m.stageProductDetails={}};function n(e,t){if("stage"===e)for(i=0;i<m.stageProductDetails.selectedColor.length;i++)for(j=0;j<m.stageProductDetails.colorArray.length;j++)m.stageProductDetails.colorArray[j].id==m.stageProductDetails.selectedColor[i].id&&(m.disabelColor[j]={opacity:.5,cursor:"not-allowed"});else if("addVariant"===e)for(i=0;i<m.productAndQtyDetails[t].selectedcolor.length;i++)for(j=0;j<m.productAndQtyDetails[t].color.length;j++)m.productAndQtyDetails[t].color[j].id===m.productAndQtyDetails[t].selectedcolor[i].id&&(m.productAndQtyDetails[t].selectedColorDisabled[j]={opacity:.5,cursor:"not-allowed"})}function q(e){var t=new Date(e),o=""+(t.getMonth()+1),r=""+t.getDate(),i=t.getFullYear();return o.length<2&&(o="0"+o),r.length<2&&(r="0"+r),[i,o,r].join("-")}function I(e){return new Set(e).size!==e.length}m.addNewProduct=function(){var e;e=angular.copy(m.quoteFormDetailsObj);var t=m.productAndQtyDetails.push(e)-1;if(0!=m.productAndQtyDetails[t].selectedcolor.length)for(m.productAndQtyDetails[t].selectedcolor[0].capturBase64Images=[],i=0;i<e.selectedProductImage.length;i++)m.quoteFormDetailsObj.selctedTemplate?u(e.selectedProductImage[i],e.selectedcolor[0].colorUrl,0,t,"addNewProduct"):u(e.selectedProductImage[i],"#ffffff",0,t,"addNewProduct");else for(i=0;i<e.selectedProductImage.length;i++)u(e.selectedProductImage[i],"#ffffff",0,t,"noColor");for(m.isColorSet=!1,m.quoteFormDetailsObj.productDetails="",m.quoteFormDetailsObj.colorDetails="",m.quoteFormDetailsObj.selectedProduct="",i=0;i<m.productList.length;i++)m.productList[i].id===e.selectedProductId&&m.productList.splice(i,1)},m.addAnotherColor=function(e){0<m.productAndQtyDetails[e].color.length&&(m.showAddColorDiv[e]=!m.showAddColorDiv[e]),n("addVariant",e)},m.removeVarints=function(e,t,o){for(j=0;j<m.productAndQtyDetails[e].color.length;j++)m.productAndQtyDetails[e].color[j].id===m.productAndQtyDetails[e].selectedcolor[t].id&&(m.productAndQtyDetails[e].selectedColorDisabled[j]={opacity:1,cursor:"pointer"});if(1===m.productAndQtyDetails[e].selectedcolor.length)return m.showAddColorDiv[t]=!1,m.productList.push(m.productAndQtyDetails[e].productDetails),void m.productAndQtyDetails.splice(e,1);m.productAndQtyDetails[e].selectedcolor.splice(t,1)},m.removeVarintsNocolor=function(e,t){m.productList.push(m.productAndQtyDetails[e].productDetails),m.productAndQtyDetails.splice(e,1)},m.addVariantStageProduct=function(e){0<m.stageProductDetails.colorArray.length&&(m.showColorDemo=!m.showColorDemo),n("stage")},m.removeProductStage=function(e){for(1===m.stageProductDetails.selectedColor.length&&(m.showColorDemo=!1),j=0;j<m.stageProductDetails.colorArray.length;j++)m.stageProductDetails.colorArray[j].id==m.stageProductDetails.selectedColor[e].id&&(m.disabelColor[j]={opacity:1,cursor:"pointer"});m.stageProductDetails.selectedColor.splice(e,1),A=[]},m.changeColor=function(r,t,i){var o=!0,a=!0,d=m.stageProductDetails.colorArray;angular.forEach(m.stageProductDetails.selectedColor,function(e,t){a&&(e.id==r.id?a=!(o=!0):o=!1)}),o&&0!==m.stageProductDetails.selectedColor.length||(m.colorLoader=!0,D.getSizeVariant(t,r.id).then(function(e){if(e.data){angular.forEach(e.data.quantities,function(e,t){e.minQuantity=0===t?1:0}),m.stageProductDetails.colorArray[i].size=[],m.stageProductDetails.colorArray[i].size=e.data.quantities;var o=m.stageProductDetails.selectedColor.push(m.stageProductDetails.colorArray[i])-1;m.stageProductDetails.selectedColor[o].capturBase64Images=[],D.getProductDetailsByClient(t,r.id).then(function(e){e.data&&""!==e.data&&angular.forEach(e.data.sides,function(e,t){m.stageProductDetails.productDetails.is_product_template?u(e,d[i].colorUrl,o):u(e,"#ffffff",o)})}),0==e.data.quantities[0].xe_size_id&&(m.stageProductDetails.selectedProductPrice=e.data.quantities[0].price),n("stage"),m.stageProductDetails.colorArray.length==m.stageProductDetails.selectedColor.length&&(m.showColorDemo=!1),m.colorLoader=!1}}))},m.changeColorProductVariant=function(o,r,a,d){var s=!0,l=!0,c=m.productAndQtyDetails[o].color;angular.forEach(m.productAndQtyDetails[o].selectedcolor,function(e,t){l&&(e.id==a.id?l=!(s=!0):s=!1)}),s||(m.colorAddProductLoader=!0,D.getSizeVariant(d,a.id).then(function(e){if(e.data){angular.forEach(e.data.quantities,function(e,t){e.minQuantity=0===t?1:0}),m.productAndQtyDetails[o].size=e.data.quantities,m.productAndQtyDetails[o].color[r].size=[],m.productAndQtyDetails[o].color[r].size=e.data.quantities;var t=m.productAndQtyDetails[o].selectedcolor.push(m.productAndQtyDetails[o].color[r])-1;m.productAndQtyDetails[o].selectedcolor[t].capturBase64Images=[],D.getProductDetailsByClient(d,a.id).then(function(e){if(m.quoteFormDetailsObj.selctedTemplate)for(i=0;i<e.data.sides.length;i++)u(e.data.sides[i],c[r].colorUrl,t,o,"addNewProduct");else for(i=0;i<e.data.sides.length;i++)u(e.data.sides[i],"#ffffff",t,o,"addNewProduct")}),0==e.data.quantities[0].xe_size_id&&(m.productAndQtyDetails[o].selectedProductPrice=e.data.quantities[0].price),n("addVariant",o),m.productAndQtyDetails[o].selectedcolor.length==m.productAndQtyDetails[o].color.length&&(m.showAddColorDiv[o]=!1)}m.colorAddProductLoader=!1}))},m.onclickCountryDetails=function(e){0!=e&&D.getAllStateByCountryCode(e).then(function(e){m.stateList=e.data})},m.generateQuote=function(s,l,c,n){var u=y.getCapturedData(),p=y.getStateJSON(y.getFaceData().length),g=f.getCustomerId(),e=y.getStateJSON(y.getFaceData().length),o=0,t=!0,r=!0;if(A=[],C=[],L(),v(),angular.forEach(m.stageProductDetails.productDetails.quantities,function(e,t){0!=e.quantityVal&&null!=e.quantityVal||o++}),o==m.stageProductDetails.productDetails.quantities.length)return m.productStageError=!0,void P(function(){m.productStageError=!1},2e3);if(""!=s&&null!=s)if(""!=l&&null!=l)if(""!=c&&null!=c){if(I(m.stageProductDetails.selectedColor))return m.sameColorRepeatError=!0,void P(function(){m.sameColorRepeatError=!1},2e3);for(i=0;i<m.stageProductDetails.selectedColor.length;i++)for(j=0;j<m.stageProductDetails.selectedColor[i].size.length;j++){if(null!=m.stageProductDetails.selectedColor[i].size[j].minQuantity&&""!=m.stageProductDetails.selectedColor[i].size[j].minQuantity){t=!0;break}t=!1}if(0!=m.productAndQtyDetails.length){var a=m.productAndQtyDetails;for(i=0;i<a.length;i++)if(""==a[i].color)r=""!=a[i].qty&&null!=a[i].qty&&"0"!=a[i].qty;else{if(I(a[i].selectedcolor))return m.sameColorRepeatError=!0,ac,void P(function(){m.sameColorRepeatError=!1},2e3);for(j=0;j<a[i].selectedcolor.length;j++)for(k=0;k<a[i].selectedcolor[j].size.length;k++){if(null!=a[i].selectedcolor[j].size[k].minQuantity&&""!=a[i].selectedcolor[j].size[k].minQuantity&&0!=a[i].selectedcolor[j].size[k].minQuantity){r=!0;break}r=!1}}}if(!0===t&&!0===r){m.formLoader=!0;var d=setInterval(function(){_&&b&&(clearInterval(d),D.getRefId(e).then(function(e){if(""!=e.data&&"success"==e.data.status){var t=e.data.refId,o=[],r=m.stageProductDetails,a=0;if(addProductVariant=m.productAndQtyDetails,0!=r.productDetails.quantities.length)for(index=0;index<r.productDetails.quantities.length;index++)if(0!==r.productDetails.quantities[index].quantityVal){var d=null==r.productDetails.quantities[index].price?r.productDetails.price:r.productDetails.quantities[index].price;a=r.designPrice-parseFloat(d),o.push({pId:r.productDetails.pid,pName:r.productDetails.pname,simple_product_id:r.productDetails.pvid,unit_price:d,quantity:r.productDetails.quantities[index].quantityVal,sub_total_price:parseFloat(r.productDetails.quantities[index].quantityVal*d).toFixed(),color:r.productDetails.xecolor,size:r.productDetails.quantities[index].xe_size,print_profile:f.getPrintId(),design_price:r.designPrice-parseFloat(d),captureData:u,price_after_design:parseFloat(r.productDetails.quantities[index].quantityVal*r.designPrice).toFixed(2)})}if(0!=r.selectedColor.length)for(i=0;i<r.selectedColor.length;i++)if(0!==r.selectedColor[i].size.length)for(j=0;j<r.selectedColor[i].size.length;j++)if(0!=r.selectedColor[i].size[j].minQuantity){d=null==r.selectedColor[i].size[j].price?r.productDetails.price:r.selectedColor[i].size[j].price;o.push({pId:r.productDetails.pid,pName:r.productDetails.pname,simple_product_id:r.selectedColor[i].size[j].simpleProductId,unit_price:d,quantity:r.selectedColor[i].size[j].minQuantity,sub_total_price:parseFloat(r.selectedColor[i].size[j].minQuantity*d).toFixed(2),color:r.selectedColor[i].xeColor,size:r.selectedColor[i].size[j].xe_size,print_profile:f.getPrintId(),design_price:a,captureData:r.selectedColor[i].capturBase64Images,price_after_design:parseFloat(d)+parseFloat(r.designPrice)*r.selectedColor[i].size[j].minQuantity})}if(0!=addProductVariant.length)for(i=0;i<addProductVariant.length;i++)if(0!==addProductVariant[i].selectedcolor.length){for(j=0;j<addProductVariant[i].selectedcolor.length;j++)if(0!==addProductVariant[i].selectedcolor[j].size.length)for(k=0;k<addProductVariant[i].selectedcolor[j].size.length;k++)if(0!=addProductVariant[i].selectedcolor[j].size[k].minQuantity){d=null==addProductVariant[i].selectedcolor[j].size[k].price?addProductVariant[i].selectedProductPrice:addProductVariant[i].selectedcolor[j].size[k].price;o.push({pId:addProductVariant[i].selectedProductId,pName:addProductVariant[i].selectedProduct,simple_product_id:addProductVariant[i].selectedcolor[j].size[k].simpleProductId,unit_price:d,quantity:addProductVariant[i].selectedcolor[j].size[k].minQuantity,sub_total_price:parseFloat(addProductVariant[i].selectedcolor[j].size[k].minQuantity*d).toFixed(2),color:addProductVariant[i].selectedcolor[j].xeColor,size:addProductVariant[i].selectedcolor[j].size[k].xe_size,print_profile:f.getPrintId(),design_price:a,captureData:addProductVariant[i].selectedcolor[j].capturBase64Images,price_after_design:addProductVariant[i].selectedcolor[j].size[k].minQuantity*parseFloat(d)+parseFloat(r.designPrice)})}}else 0!=addProductVariant[i].qty&&o.push({pId:addProductVariant[i].selectedProductId,pName:addProductVariant[i].selectedProduct,simple_product_id:addProductVariant[i].selectedSimpleProductId,unit_price:addProductVariant[i].selectedProductPrice,quantity:addProductVariant[i].qty,sub_total_price:parseFloat(addProductVariant[i].qty*addProductVariant[i].selectedProductPrice).toFixed(2),color:addProductVariant[i].xeColor,size:addProductVariant[i].xe_size,print_profile:f.getPrintId(),design_price:a,captureData:addProductVariant[i].capturBase64Images,price_after_design:addProductVariant[i].qty*parseFloat(r.designPrice)+parseFloat(addProductVariant[i].selectedProductPrice)});""==m.billingAddress.billing_country_code||null==m.billingAddress.billing_country_code?(m.formLoader=!1,0!=n.country&&null!=n.country&&""!=n.country&&0!=n.state&&null!=n.state&&""!=n.state&&""!=n.city&&null!=n.city&&""!=n.postcode&&null!=n.postcode&&""!=n.address_line_one&&null!=n.address_line_one?(m.formLoader=!0,m.sendCustomerObject.billing_address_1=n.address_line_one,m.sendCustomerObject.billing_address_2=n.address_line_two,m.sendCustomerObject.billing_city=n.city,m.sendCustomerObject.billing_state_code=n.state,m.sendCustomerObject.billing_zip=n.postcode,m.sendCustomerObject.billing_country_code=n.country,m.sendCustomerObject.shipping_address_1=n.address_line_one,m.sendCustomerObject.shipping_address_2=n.address_line_two,m.sendCustomerObject.shipping_city=n.city,m.sendCustomerObject.shipping_zip=n.postcode,m.sendCustomerObject.shipping_country_code=n.country,m.sendCustomerObject.shipping_state_code=n.state,D.submitQuoteRequest(g,p,u,t,s,q(l),c,"",JSON.stringify(o),m.sendCustomerObject,m.isAddressEdit).then(function(e){"success"==e.data.status?(m.formLoader=!1,m.closeQuote("success")):(m.formLoader=!1,m.closeQuote("failed"))})):(m.quoteCustomerDetailsValidator=!0,P(function(){m.quoteCustomerDetailsValidator=!1},2e3))):D.submitQuoteRequest(g,p,u,t,s,q(l),c,m.billingAddress.selectedShippingId,JSON.stringify(o),"",m.isAddressEdit).then(function(e){"success"==e.data.status?(m.formLoader=!1,m.closeQuote("success")):(m.formLoader=!1,m.closeQuote("failed"))})}else m.$emit(h.ALERT_SHOW,{message:"stage capture Failed"})}))},100)}else m.productStageError=!0,P(function(){m.productStageError=!1},2e3)}else m.quoteDetailsValidator=!0,P(function(){m.quoteDetailsValidator=!1},2e3);else m.quoteDetailsValidator=!0,P(function(){m.quoteDetailsValidator=!1},2e3);else m.quoteDetailsValidator=!0,P(function(){m.quoteDetailsValidator=!1},2e3)};var d=function(t){m.isAddNewAddresss=!1;var e=o.getCustomerAddress();""!==e.shipping_country_code?(m.isAddressEdit=!1,m.billingAddress.store_customer_id=e.store_customer_id,m.sendCustomerObject.first_name=e.first_name,m.sendCustomerObject.last_name=e.last_name,m.billingAddress.billing_country_code=e.billing_country_code,D.getAllShippingAddress(f.getCustomerId()).then(function(e){m.addressLoader=!1,e.data&&void 0!==e.data.shipping&&0<e.data.shipping.length&&(m.billingAddress.multiShippingAddress=e.data.shipping,"selectLast"==t?(m.addedLast=!0,m.shipAddChecked=m.billingAddress.multiShippingAddress[m.billingAddress.multiShippingAddress.length-1].id,m.billingAddress.selectedShippingId=m.billingAddress.multiShippingAddress[m.billingAddress.multiShippingAddress.length-1].id):(m.shipAddChecked=m.billingAddress.multiShippingAddress[0].id,m.billingAddress.selectedShippingId=m.billingAddress.multiShippingAddress[0].id,m.addedLast=!1))}),D.getAllStateByCountryCode(e.shipping_country_code).then(function(e){m.stateList=e.data,m.formLoader=!1})):(m.sendCustomerObject.store_customer_id=e.store_customer_id,m.sendCustomerObject.first_name=e.first_name,m.sendCustomerObject.last_name=e.last_name,m.isAddressEdit=!0,m.formLoader=!1)};m.changeIndex=function(e,t){m.shipAddChecked=t.id,m.billingAddress.selectedShippingId=t.id},m.addNewAddress=function(){m.isAddNewAddresss=!0,m.billingAddress.newShippingAddress={}},m.resetAllAddress=function(){m.billingAddress.newShippingAddress={},m.isAddNewAddresss=!1},m.saveNewAddress=function(e){0!=e.country&&null!=e.country&&""!=e.country&&0!=e.state&&null!=e.state&&""!=e.state&&""!=e.city&&null!=e.city&&""!=e.postcode&&null!=e.postcode&&""!=e.address_line_one&&null!=e.address_line_one?(m.isAddNewAddresss=!1,m.addressLoader=!0,m.isAddressEdit=!1,D.addShippingAddress(e).then(function(e){"Success"==e.data.status&&d("selectLast")})):(m.quoteCustomerDetailsValidator=!0,P(function(){m.quoteCustomerDetailsValidator=!1},2e3))};var u=function(t,e,o,r,i){var a=m.stageProductDetails.productDetails.dimension||{x:0,y:0,height:500,width:500},d=1,s=document.getElementById("stageCapture");s.setAttribute("height",200),s.setAttribute("width",200);var l=new fabric.Canvas("stageCapture");if(d=a.width>a.height?m.captureWt/a.width:m.captureWt/a.height,"addNewProduct"==i){(c=document.getElementById("patternImage").cloneNode(!0)).getElementsByTagName("g")[0].setAttribute("transform","translate("+-a.x+","+-a.y+")scale("+d+","+d+")");"#"==e.charAt(0)&&$(c).find("rect")[0].setAttribute("fill",e),(n=document.createElement("canvas")).setAttribute("id","captureCanvas"),n.height=m.captureHt,n.width=m.captureWt,canvg(n,c.outerHTML,{ignoreDimensions:!0,scaleWidth:500,scaleHeight:500,renderCallback:function(){var e=n.toDataURL("image/png");fabric.Image.fromURL(e,function(e){e.width=a.width*d,e.height=a.height*d,e.x=a.x*d,e.y=a.y*d,l.add(e),l.centerObject(e),fabric.Image.fromURL(t,function(e){e.width=e.height=200,l.add(e),l.centerObject(e),m.productAndQtyDetails[r].selectedcolor[o].capturBase64Images.push(l.toDataURL())},{crossOrigin:"anonymous"})},{crossOrigin:"anonymous"})}})}else if("noColor"==i){(c=document.getElementById("patternImage").cloneNode(!0)).getElementsByTagName("g")[0].setAttribute("transform","translate("+-a.x+","+-a.y+")scale("+d+","+d+")");"#"==e.charAt(0)&&$(c).find("rect")[0].setAttribute("fill",e),(n=document.createElement("canvas")).setAttribute("id","captureCanvas"),n.height=m.captureHt,n.width=m.captureWt,canvg(n,c.outerHTML,{ignoreDimensions:!0,scaleWidth:500,scaleHeight:500,renderCallback:function(){var e=n.toDataURL("image/png");fabric.Image.fromURL(e,function(e){e.width=a.width*d,e.height=a.height*d,e.x=a.x*d,e.y=a.y*d,l.add(e),l.centerObject(e),fabric.Image.fromURL(t,function(e){e.width=e.height=200,l.add(e),l.centerObject(e),console.log(l.toDataURL()),m.productAndQtyDetails[r].capturBase64Images.push(l.toDataURL())},{crossOrigin:"anonymous"})},{crossOrigin:"anonymous"})}})}else{var c,n;(c=document.getElementById("patternImage").cloneNode(!0)).getElementsByTagName("g")[0].setAttribute("transform","translate("+-a.x+","+-a.y+")scale("+d+","+d+")");"#"==e.charAt(0)&&$(c).find("rect")[0].setAttribute("fill",e),(n=document.createElement("canvas")).setAttribute("id","captureCanvas"),n.height=m.captureHt,n.width=m.captureWt,canvg(n,c.outerHTML,{ignoreDimensions:!0,scaleWidth:500,scaleHeight:500,renderCallback:function(){var e=n.toDataURL("image/png");fabric.Image.fromURL(e,function(e){e.width=a.width*d,e.height=a.height*d,e.x=a.x*d,e.y=a.y*d,l.add(e),l.centerObject(e),fabric.Image.fromURL(t,function(e){e.width=e.height=200,l.add(e),l.centerObject(e),m.stageProductDetails.selectedColor[o].capturBase64Images.push(l.toDataURL())},{crossOrigin:"anonymous"})},{crossOrigin:"anonymous"})}})}},v=function(){y.getRatserBase64();for(var e=0;e<m.stageProductDetails.selectedColor.length;e++)_variantsUrl=m.stageProductDetails.selectedColor[e].capturBase64Images,A.push({xe_color_id:m.stageProductDetails.selectedColor[e].xeColor,urls:_variantsUrl,colorSwatch:m.stageProductDetails.selectedColor[e].colorUrl});var t=angular.copy(A);_=0==t.length,s(t,0,0)},L=function(){for(i=0;i<m.productAndQtyDetails.length;i++)if(C[i]=[],0!=m.productAndQtyDetails[i].selectedcolor.length)for(j=0;j<m.productAndQtyDetails[i].selectedcolor.length;j++)_variantsUrl=m.productAndQtyDetails[i].selectedcolor[j].capturBase64Images,C[i].push({xe_color_id:m.productAndQtyDetails[i].selectedcolor[j].xeColor,urls:_variantsUrl,colorSwatch:m.productAndQtyDetails[i].selectedcolor[j].colorUrl});else _variantsUrl=m.productAndQtyDetails[i].capturBase64Images,C[i].push({xe_color_id:"No Color",urls:_variantsUrl,colorSwatch:"#ffffff"});var e=angular.copy(C);b=0==e.length,l(e,0,0,0)};function s(e,t,o){var r=y.getRatserBase64();t=t||0,o=o||0;e&&t<e.length&&(e[t]&&e[t].urls&&o<e[t].urls.length?c(e,t,o,e[t].urls[o],r[o]):e[t]&&e[t].urls&&o>=e[t].urls.length&&s(e,t+1,0))}function l(e,t,o,r,i){var a=y.getRatserBase64();if("callBack"==i){t=t||0,o=o||0;e&&t<e.length&&(e[t]&&e[t].urls&&o<e[t].urls.length?p(e,t,o,e[t].urls[o],a[o],r):e[t]&&e[t].urls&&o>=e[t].urls.length&&l(e,t+1,0,r,"callBack"))}else{t=t||0,o=o||0;e[r]&&t<e[r].length&&(e[r][t]&&e[r][t].urls&&o<e[r][t].urls.length?p(e[r],t,o,e[r][t].urls[o],a[o],r):e[r][t]&&e[r][t].urls&&o>=e[r][t].urls.length&&l(e[r],t+1,0,r))}}var c=function(o,r,i,e,a){var d=new fabric.Canvas("stageCapture");fabric.Image.fromURL(e,function(e){if(e.width=e.height=200,d.add(e),d.centerObject(e),a)fabric.Image.fromURL(a,function(e){e.width=e.height=200;jQuery.extend(!0,{},e);d.add(e),d.centerObject(e),d.renderAll();var t=d.toDataURL();o[r].urls[i]=t,o.length==r+1&&o[r].urls.length==i+1?g(o):s(o,r,i+1)});else{d.renderAll();var t=d.toDataURL();o[r].urls[i]=t,o.length==r+1&&o[r].urls.length==i+1?g(o):s(o,r,i+1)}},{crossOrigin:"anonymous"})},p=function(o,r,i,e,a,d){var s=new fabric.Canvas("stageCapture");fabric.Image.fromURL(e,function(e){if(e.width=e.height=200,s.add(e),s.centerObject(e),a)fabric.Image.fromURL(a,function(e){e.width=e.height=200;jQuery.extend(!0,{},e);s.add(e),s.centerObject(e),s.renderAll();var t=s.toDataURL();o[r].urls[i]=t,o.length==r+1&&o[r].urls.length==i+1?O(o,d):l(o,r,i+1,d,"callBack")});else{s.renderAll();var t=s.toDataURL();o[r].urls[i]=t,o.length==r+1&&o[r].urls.length==i+1?O(o,d):l(o,r,i+1,d,"callBack")}},{crossOrigin:"anonymous"})},g=function(e){angular.forEach(e,function(e,t){m.stageProductDetails.selectedColor[t].capturBase64Images=e.urls}),_=!0},O=function(e,o){angular.forEach(e,function(e,t){"No Color"==e.xe_color_id?m.productAndQtyDetails[o].capturBase64Images=e.urls:m.productAndQtyDetails[o].selectedcolor[t].capturBase64Images=e.urls}),b=o===C.length-1||(l(C,0,0,o+1),!1)}}])}),require(["quoteRequest/controllers/controller","quoteRequest/services/service","quoteRequest/models/model"]);